

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/logo.png">
  <link rel="icon" href="/img/logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Hailey">
  <meta name="keywords" content="Notebook">
  
    <meta name="description" content="首先对Feynman-Kac theorem进行基本函数定义，推导并证明基本特性; 其次，展示五个版本的Black-Scholes-PDE推导，前三个采用了Feynman-Kac theorem，但是给的公式都不相同，后两个用的配无风险组合；">
<meta property="og:type" content="article">
<meta property="og:title" content="【推导】Feynman-Kac To Black-Scholes-PDE">
<meta property="og:url" content="http://achlier.github.io/2021/03/14/Feynman-Kac_To_Black-Scholes-PDE/index.html">
<meta property="og:site_name" content="Borderland">
<meta property="og:description" content="首先对Feynman-Kac theorem进行基本函数定义，推导并证明基本特性; 其次，展示五个版本的Black-Scholes-PDE推导，前三个采用了Feynman-Kac theorem，但是给的公式都不相同，后两个用的配无风险组合；">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-03-13T16:04:57.000Z">
<meta property="article:modified_time" content="2022-03-09T10:41:59.296Z">
<meta property="article:author" content="Hailey">
<meta property="article:tag" content="Black Scholes Model">
<meta property="article:tag" content="Feynman-Kac">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>【推导】Feynman-Kac To Black-Scholes-PDE - Borderland</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"achlier.github.io","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":false,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Achlier&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="【推导】Feynman-Kac To Black-Scholes-PDE"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-03-14 00:04" pubdate>
          March 14, 2021 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9.3k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          78 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">【推导】Feynman-Kac To Black-Scholes-PDE</h1>
            
            <div class="markdown-body">
              
              <blockquote>
<p>首先对Feynman-Kac theorem进行基本函数定义，推导并证明基本特性;</p>
<p>其次，展示五个版本的Black-Scholes-PDE推导，前三个采用了Feynman-Kac theorem，但是给的公式都不相同，后两个用的配无风险组合；</p>
</blockquote>
<span id="more"></span>
<h1 id="Feynman-Kac-theorem"><a href="#Feynman-Kac-theorem" class="headerlink" title="Feynman-Kac theorem"></a>Feynman-Kac theorem</h1><blockquote>
<p>Cox-Ross-Robinsten 决定的 u and d</p>
</blockquote>
<p>基于B站 <a target="_blank" rel="noopener" href="https://space.bilibili.com/275959084">Jerry Xu</a> 视频的笔记</p>
<p><strong>衍生品的 Probabilistic model</strong></p>
<script type="math/tex; mode=display">
\mathbb{E}^\mathbb{Q}[e^{-r(T-t)}F(S_T)|\mathcal{F}_t]=u(t,x)</script><p>where $F(·):$ payoff, $u(t,x) :$ value at time t </p>
<p><strong>衍生品的 Partial differential equation</strong></p>
<script type="math/tex; mode=display">
\frac{\partial u}{\partial t}+rx\frac{\partial u}{\partial x}+\frac{1}{2}\sigma^2x^2\frac{\partial^2 u}{\partial x^2}=rx</script><p><strong>Feynman-Kac theorem</strong> 将两者联系起来，只要两者知一，就能知道另一个</p>
<h3 id="基本定义"><a href="#基本定义" class="headerlink" title="基本定义"></a>基本定义</h3><p><strong>Kronecker delta（克罗内克函数）</strong></p>
<script type="math/tex; mode=display">
\delta_{ij}=\begin{cases}0&,i\ne j\\1&,i=j\end{cases}</script><p><strong>股票价值</strong></p>
<script type="math/tex; mode=display">
\overrightarrow{X}_t=(x_t^{(1)},x_t^{(2)},...,x_t^{(d)})^T\in\mathbb{R}^{d\times 1}</script><script type="math/tex; mode=display">
dX_t=\mu(t,X_t)dt+\sigma(t,X_t)dB_t</script><script type="math/tex; mode=display">
\begin{bmatrix}
\mu_1\\ \mu_2\\...\\ \mu_d
\end{bmatrix}_{d\times 1}
+
\begin{bmatrix}
\sigma_{11}&\sigma_{12}&...&\sigma_{1m}\\
\sigma_{21}&\sigma_{22}&...&\sigma_{2m}\\
...&...&...&...\\
\sigma_{d1}&\sigma_{d2}&...&\sigma_{dm}\\
\end{bmatrix}_{d\times m}
\times
\begin{bmatrix}
dB_t^{(1)}\\ dB_t^{(2)}\\...\\ dB_t^{(m)}
\end{bmatrix}_{m\times 1}</script><p>$B_t$: m-dimensioned BM [uncorrelated]</p>
<script type="math/tex; mode=display">
dB_idB_j=\begin{cases}dt&,i= j\\ \rho dt=0&,i\ne j\end{cases}</script><p>Also can be shown as</p>
<script type="math/tex; mode=display">
\begin{align}
dx_t^{(i)}&=\mu_idt+\sum_{k=1}^m\sigma_{ik}dB_t^{(k)},\ i\in \{1,2,...,d\}\\
dx_t^{(j)}&=\mu_jdt+\sum_{l=1}^m\sigma_{jl}dB_t^{(l)},\ j\in \{1,2,...,d\}
\end{align}</script><p>So we have</p>
<script type="math/tex; mode=display">
\begin{align}
dx_t^{(i)}dx_t^{(j)}&=(\sum_{k=1}^m\sigma_{ik}dB_t^{(k)})(\sum_{l=1}^m\sigma_{jl}dB_t^{(l)})\\
&=\sum_{k=1}^m\sum_{l=1}^m\sigma_{ik}\sigma_{jl}dB_t^{(k)}dB_t^{(l)}\\
&=\sum_{k=1}^m\sum_{l=1}^m\sigma_{ik}\sigma_{jl}\delta_{kl}dt\\
&=\sum_{k=1}^m\sigma_{ik}\sigma_{jK}dt
\end{align}</script><p><strong>Generator</strong></p>
<script type="math/tex; mode=display">
A=\sum_{i=1}^d\mu_i\frac{\partial}{\partial x_i}+\frac{1}{2}\sum_{i=1}^d\sum_{j=1}^d(\sigma \sigma^T)_{ij}\frac{\partial^2}{\partial x_i\partial x_j}</script><p>with</p>
<script type="math/tex; mode=display">
\begin{matrix}u(t,\underbrace{x_1,x_2,...,x_d})\\ \quad x_t^{(1)},x_t^{(2)},...,x_t^{(d)} \end{matrix}</script><p>With $u(t,\overrightarrow{X}_t)$ and $r(t,\overrightarrow{X}_t)$, <strong>prove $M_t$ is a martingale</strong></p>
<script type="math/tex; mode=display">
M_t=e^{-\int_0^trds}u-\int_0^te^{-\int_0^srdv}(\frac{\partial u}{\partial t}+Au-ru)ds</script><p><strong>Proof</strong>：</p>
<p>Set $F_t=e^{-\int_0^trds}u$</p>
<script type="math/tex; mode=display">
\begin{align}
dF_t&=[de^{-\int_0^trds}]u+e^{-\int_0^trds}du+0\\
&=-re^{-\int_0^trds}udt+e^{-\int_0^trds}[\frac{\partial u}{\partial t}dt+\sum_{i=1}^d\frac{\partial u}{\partial x_i}dx_t^{(i)}...\\
&...+\frac{1}{2}\sum_{i=1}^d\sum_{j=1}^d\frac{\partial^2 u}{\partial x_i\partial x_j}dx_t^{(i)}dx_t^{(j)}]\\
&=e^{-\int_0^trds}[-rudt+\frac{\partial u}{\partial t}dt+\sum_{i=1}^d\frac{\partial u}{\partial x_i}\mu_idt+\sum_{i=1}^d\frac{\partial u}{\partial x_i}\sum_{k=1}^m\sigma_{ik}dB_t^{(k)}...\\
&...+\frac{1}{2}\sum_{i=1}^d\sum_{j=1}^d\frac{\partial^2 u}{\partial x_i\partial x_j}\sum_{k=1}^m\sigma_{ik}\sigma_{jK}dt]\\
&=e^{-\int_0^trds}[-ru+\frac{\partial u}{\partial t}+\sum_{i=1}^d\frac{\partial u}{\partial x_i}\mu_i+\frac{1}{2}\sum_{i=1}^d\sum_{j=1}^d\frac{\partial^2 u}{\partial x_i\partial x_j}(\sigma \sigma^T)_{ij}]dt...\\
&...+e^{-\int_0^trds}(\nabla u)^T\sigma dB_t\\
&=e^{-\int_0^trds}[-ru+\frac{\partial u}{\partial t}+Au]dt+e^{-\int_0^trds}(\nabla u)^T\sigma dB_t
\end{align}</script><p>So</p>
<script type="math/tex; mode=display">
\begin{align}
dM_t&=dF_t-e^{-\int_0^trdv}(\frac{\partial u}{\partial t}+Au-ru)dt\\
&=e^{-\int_0^trds}(\nabla u)^T\sigma dB_t
\end{align}</script><p>$\Rightarrow M_t$ is a Martingale</p>
<p><strong>Similarly</strong></p>
<p>Set $t\leq t’\leq T$ with $X_t^{t,x}=x$</p>
<script type="math/tex; mode=display">
\tilde{M}_{t'}=e^{-\int_t^{t'}rds}u-\int_t^{t'}e^{-\int_t^srdv}(\frac{\partial u}{\partial t}+Au-ru)ds</script><p>$\Rightarrow \tilde{M}_{t’}$ is also a Martingale</p>
<p>So $\mathbb{E}[\tilde{M}_T]=\mathbb{E}[\tilde{M}_t]=\tilde{M}_t=u(t,x)$</p>
<h3 id="Feynman-Kac-证明"><a href="#Feynman-Kac-证明" class="headerlink" title="Feynman-Kac 证明"></a>Feynman-Kac 证明</h3><p>( Feynman-Kac Formula ) Let $X_t$ is an Ito diffusion given by</p>
<script type="math/tex; mode=display">
d\overrightarrow{X}_t=\mu(t,\overrightarrow{X}_t)dt+\sigma(t,\overrightarrow{X}_t)d\overrightarrow{B}_t</script><p>with generator A and initial condition $X_t^{t,x}=x$</p>
<p>Let $u(t,\overrightarrow{X}_t)$, $t\in\mathbb{R}^+$, $\overrightarrow{X}_t\in\mathbb{R}^{d\times 1}$ satisfy</p>
<script type="math/tex; mode=display">
\frac{\partial u}{\partial t}+Au-ru=0 \tag{1}</script><p>with final condition $u(T,x)=f(x)$</p>
<p>Then</p>
<script type="math/tex; mode=display">
\begin{align}
u(t,x)&=\mathbb{E}[e^{-\int_t^Tr(s,x_s)ds}f(X_T)|\mathcal{F}_t]\\
&=\mathbb{E}[e^{-\int_t^Tr(s,x_s)ds}f(X_T)|X(t)=x]\\
&=\mathbb{E}[e^{-\int_t^Tr(s,X_s^{t,x})ds}f(X_T^{t,x})]
\end{align}</script><p>Proof：</p>
<p>we have </p>
<script type="math/tex; mode=display">
\mathbb{E}[\tilde{M}_{T}]=\mathbb{E}[e^{-\int_t^{T}r(S,X_s^{t,x})ds}u(T,X_T^{t,x})-\int_t^{T}e^{-\int_t^sr(v,X_v^{t,x})dv}(\frac{\partial u}{\partial t}+Au-ru)(s,X_s^{t,x})ds]</script><p>Under condition (1)</p>
<script type="math/tex; mode=display">
\mathbb{E}[\tilde{M}_{T}]=\mathbb{E}[e^{-\int_t^{T}r(S,X_s^{t,x})ds}u(T,X_T^{t,x})]</script><p>and final condition</p>
<script type="math/tex; mode=display">
\mathbb{E}[\tilde{M}_{T}]=\mathbb{E}[e^{-\int_t^{T}r(S,X_s^{t,x})ds}f(X_T^{t,x})] \tag{2}</script><p><strong>总结：凡是满足以上的所有条件的，都能写成期望公式(2)的格式，因此两种形式可以互通</strong></p>
<h1 id="Black-Scholes-PDE推导"><a href="#Black-Scholes-PDE推导" class="headerlink" title="Black-Scholes-PDE推导"></a>Black-Scholes-PDE推导</h1><h3 id="1-三个采用Feynman-Kac-theorem的推导"><a href="#1-三个采用Feynman-Kac-theorem的推导" class="headerlink" title="1. 三个采用Feynman-Kac theorem的推导"></a>1. 三个采用Feynman-Kac theorem的推导</h3><h4 id="【第一版-B站版】"><a href="#【第一版-B站版】" class="headerlink" title="【第一版-B站版】"></a>【第一版-B站版】</h4><p>根据B站<a target="_blank" rel="noopener" href="https://space.bilibili.com/453522144">杨维强老师</a>的讲解，将Feynman-Kac theorem比作了一个连接SDE与PDE的桥梁</p>
<p>Recall：</p>
<script type="math/tex; mode=display">
SDE: dX_t = \mu(X_t)dt + \sigma(X_t)dB_t \ , \ X_0 = x</script><p>Feynman-Kac theorem 使用概率方法去解出PDE：</p>
<script type="math/tex; mode=display">
u(t,x) = E^X[e^{-\int_0^t\lambda(X_s)ds}f(X_t)]</script><p>其中：</p>
<script type="math/tex; mode=display">
PDE: u_t = \mu(x)u_x+\frac{1}{2}\sigma^2(x)u_{xx}-\lambda(x)u \ , \ u(0,x)=f(x)</script><p>有些资料会以另一个方式写(相当于做一个时间变换)：</p>
<script type="math/tex; mode=display">
PDE：u_t + \mu(x)u_x+\frac{1}{2}\sigma^2(x)u_{xx}-\lambda(x)u = 0 \ , \ u(T,x)=f(x)</script><p>由原有方程：</p>
<script type="math/tex; mode=display">
dX_t = rX_tdt + \sigma X_tdB_t\\
V(t,x) = E_Q[e^{-r(T-t)}h(X_T)|X_t=x]</script><p>当设 $\mu(x)=rx,\sigma(x)=\sigma x,\lambda(x)=r$ , 得到PDE：</p>
<script type="math/tex; mode=display">
rV = V_t + rxV_x+\frac{1}{2}\sigma^2x^2V_{xx} \ , \ V(T,x)=h(x)</script><h4 id="【第二版-格拉版】"><a href="#【第二版-格拉版】" class="headerlink" title="【第二版-格拉版】"></a>【第二版-格拉版】</h4><p>区别的地方是采用BM构建Process：</p>
<script type="math/tex; mode=display">
\begin{align}
V(t,x) &= E_Q[e^{-r(T-t)}h(X_T)|X_t=x]\\
&\Downarrow\\
V(t,x) &= E_Q[e^{-r(T-t)}h(B(T))|B(t)=f(t,x)] = u(t,f(t,x))
\end{align}</script><p>其中<script type="math/tex">B(t)</script>的式子由：</p>
<script type="math/tex; mode=display">
\begin{align}
X_t &= X_0e^{(r-\frac{\sigma^2}{2})t+\sigma B(t) }= x\\
B(t) &= \frac{ln(\frac{x}{X_0})-(r-\frac{\sigma^2}{2})t}{\sigma}=f(t,x)
\end{align}</script><p>By the Feynman-Kac theorem with $\mu(x)=0,\sigma(x)=1$：</p>
<script type="math/tex; mode=display">
ru = u_t+\frac{1}{2}u_{ff}</script><p>为了求解，得以下三个式子：</p>
<script type="math/tex; mode=display">
\begin{align}
V_t &= u_t + u_ff_t\\
V_x &= u_ff_x\\
V_{xx} &= u_{ff}(f_x)^2 + u_ff_{xx}
\end{align}</script><p>依照之前的$f(t,x)$公式</p>
<script type="math/tex; mode=display">
\begin{align}
f &= \frac{ln(\frac{x}{X_0})-(r-\frac{\sigma^2}{2})t}{\sigma}\\
f_t &= -\frac{1}{\sigma}(r-\frac{\sigma^2}{2})\\
f_x &= \frac{1}{\sigma x} \ (lnax = lna + lnx)\\
f_{xx} &= -\frac{1}{\sigma x^2}
\end{align}</script><p>代入前一个式子并换位</p>
<script type="math/tex; mode=display">
\begin{align}
V_t + \frac{1}{\sigma}(r-\frac{\sigma^2}{2})u_f &= u_t \\
\sigma xV_x &= u_f\\
\sigma^2 x^2V_{xx} + \frac{\sigma^2 x^2}{\sigma x^2}u_f &= u_{ff}
\end{align}</script><p>代入最开始的式子</p>
<script type="math/tex; mode=display">
\begin{align}
rV &= V_t +(r-\frac{\sigma^2}{2})xV_x +\frac{1}{2}(\sigma^2 x^2V_{xx} + \sigma^2 xV_x)\\
 &= V_t +rxV_x-\frac{\sigma^2 x}{2}V_x +\frac{\sigma^2 x^2}{2}V_{xx} + \frac{\sigma^2 x}{2}V_x\\
 &= V_t +rxV_x +\frac{\sigma^2 x^2}{2}V_{xx} 
\end{align}</script><h4 id="【第三版-参考书】"><a href="#【第三版-参考书】" class="headerlink" title="【第三版-参考书】"></a>【第三版-参考书】</h4><script type="math/tex; mode=display">
\begin{align}
V(t,x) &= E_Q[e^{-r(T-t)}V(X_T)|X_t=x]\\
g(t,x) &= e^{-rt}V(t,x)
\end{align}</script><p>By the Feynman-Kac theorem with time in [0,T]：</p>
<script type="math/tex; mode=display">
g_t + rxg_x+\frac{1}{2}\sigma^2 x^2g_{xx}= 0</script><p>对g求导：</p>
<script type="math/tex; mode=display">
\begin{align}
g_t &= -re^{rt}V + e^{-rt}V_t\\
g_x &= e^{-rt}V_x\\
g_{xx} &= e^{-rt}V_{xx}
\end{align}</script><p>代入：</p>
<script type="math/tex; mode=display">
\begin{align}
-re^{rt}V + e^{-rt}V_t + rxe^{-rt}V_x+\frac{1}{2}\sigma^2 x^2e^{-rt}V_{xx}= 0\\
-rV + V_t + rxV_x+\frac{1}{2}\sigma^2 x^2V_{xx}= 0\\
\end{align}</script><h3 id="2-对冲版推导"><a href="#2-对冲版推导" class="headerlink" title="2. 对冲版推导"></a>2. 对冲版推导</h3><h4 id="【第一版-Delta-对冲】"><a href="#【第一版-Delta-对冲】" class="headerlink" title="【第一版-Delta 对冲】"></a>【第一版-Delta 对冲】</h4><p>做一个Delta对冲的投资组合：</p>
<script type="math/tex; mode=display">
\Pi = C(X,t) - \Delta X \ , \ \Delta = \frac{\partial C}{\partial X}</script><p> Ito formula：</p>
<script type="math/tex; mode=display">
\begin{align}
d\Pi &= \frac{\partial C}{\partial t}dt + \frac{\partial C}{\partial X}dX + \frac{1}{2}\sigma^2X^2\frac{\partial^2C}{\partial X^2}dt - \Delta dX\\
&= \frac{\partial C}{\partial t}dt + \frac{1}{2}\sigma^2X^2\frac{\partial^2C}{\partial X^2}dt + (\frac{\partial C}{\partial X} - \Delta)dX\\
&= \frac{\partial C}{\partial t}dt + \frac{1}{2}\sigma^2X^2\frac{\partial^2C}{\partial X^2}dt
\end{align}</script><p>It should be equal to the same return as if we invested in riskless interest-bearing account：</p>
<script type="math/tex; mode=display">
d\Pi = r\Pi dt = r(C(X,t) - \Delta X)dt = r(C(X,t) - X \frac{\partial C}{\partial X})dt</script><p>because of no arbitrage：</p>
<script type="math/tex; mode=display">
\frac{\partial C}{\partial t}dt + \frac{1}{2}\sigma^2X^2\frac{\partial^2C}{\partial X^2}dt = r(C(X,t) - X \frac{\partial C}{\partial X})dt</script><p>so that：</p>
<script type="math/tex; mode=display">
\frac{\partial C}{\partial t} + rX \frac{\partial C}{\partial X} + \frac{1}{2}\sigma^2X^2\frac{\partial^2C}{\partial X^2} = rC</script><h4 id="【第二版-Ito-公式】"><a href="#【第二版-Ito-公式】" class="headerlink" title="【第二版-Ito 公式】"></a>【第二版-Ito 公式】</h4><p>建立一个期权的复制组合</p>
<ul>
<li><p>$\Delta(t)$：持有股票数</p>
</li>
<li><p>$X(t)$：portfolio 价值</p>
</li>
<li><p>股票价值增量：$dS(t)=\alpha S(t)dt+\sigma S(t)dW(t)$</p>
</li>
<li><p>portfolio 价值增量：超额收益+无风险收益+风险</p>
<script type="math/tex; mode=display">
\begin{align}
dX(t)&=\Delta(t)dS(t)+r(X(t)-\Delta(t)S(t))dt\\
&=\Delta(t)\alpha S(t)dt+\Delta(t)\sigma S(t)dW(t)+rX(t)dt-r\Delta(t)S(t)dt\\
&=(\alpha-r)\Delta(t)S(t)dt+rX(t)dt+\Delta(t)\sigma S(t)dW(t)
\end{align}</script></li>
</ul>
<p>股票价值的折现过程</p>
<script type="math/tex; mode=display">
\begin{align}
d(e^{-rt}S(t))&=S(t)de^{-rt}+e^{-rt}dS(t)+dS(t)de^{-rt}\\
&=-re^{-rt}S(t)dt+e^{-rt}(\alpha S(t)dt+\sigma S(t)dW(t))\\
&=(\alpha-r)e^{-rt}S(t)dt+e^{-rt}\sigma S(t)dW(t)
\end{align}</script><p>组合价值的折现过程</p>
<script type="math/tex; mode=display">
\begin{align}
d(e^{-rt}X(t))&=X(t)de^{-rt}+e^{-rt}dX(t)+dX(t)de^{-rt}\\
&=-re^{-rt}X(t)dt+e^{-rt}(\alpha-r)\Delta(t)S(t)dt...\\
&...+e^{-rt}rX(t)dt+e^{-rt}\Delta(t)\sigma S(t)dW(t)\\
&=\Delta(t)(e^{-rt}(\alpha-r)S(t)dt+e^{-rt}\sigma S(t)dW(t))\\
&=\Delta(t)d(e^{-rt}S(t))
\end{align}</script><ul>
<li>$C(t,x)$：Option price</li>
</ul>
<p>当复制成立时</p>
<script type="math/tex; mode=display">
d(e^{-rt}C(t,S(t)))=d(e^{-rt}X(t))</script><p>先准备</p>
<script type="math/tex; mode=display">
\begin{align}
d(C(t,S(t)))&=C_tdt+C_xdS(t)+\frac12C_{xx}dS(t)dS(t)\\
&=C_tdt+C_x(\alpha S(t)dt+\sigma S(t)dW(t))...\\
&...+\frac12C_{xx}\sigma^2S(t)^2dt\\
&=(C_t+C_x\alpha S(t)+\frac12C_{xx}\sigma^2S(t)^2)dt+C_x\sigma S(t)dW(t)
\end{align}</script><p>代入</p>
<script type="math/tex; mode=display">
\begin{align}
d(e^{-rt}C(t,S(t)))&=Cde^{-rt}+e^{-rt}dC\\
&=-re^{-rt}Cdt+e^{-rt}C_x\sigma S(t)dW(t)...\\
&...+e^{-rt}(C_t+C_x\alpha S(t)+\frac12C_{xx}\sigma^2S(t)^2)dt\\
&=e^{-rt}(C_t+C_x\alpha S(t)+\frac12C_{xx}\sigma^2S(t)^2-rC)dt...\\
&...+e^{-rt}C_x\sigma S(t)dW(t)
\end{align}</script><p>与组合价值的折现过程对比</p>
<script type="math/tex; mode=display">
\Delta(t)(e^{-rt}(\alpha-r)S(t)dt+e^{-rt}\sigma S(t)dW(t))</script><p>得出</p>
<script type="math/tex; mode=display">
\Delta(t)=C_x</script><script type="math/tex; mode=display">
rC=C_t+\frac12C_{xx}\sigma^2S(t)^2+rC_xS(t)</script><h3 id="【附加资料】"><a href="#【附加资料】" class="headerlink" title="【附加资料】"></a>【附加资料】</h3><p>Black-Scholes equation is written in the form ：</p>
<script type="math/tex; mode=display">
\frac{\partial C}{\partial t} + bX \frac{\partial C}{\partial X} + \frac{1}{2}\sigma^2X^2\frac{\partial^2C}{\partial X^2} - rC = 0</script><p>where：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Asset with on dividend</th>
<th>$b = r$</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Asset with dividend $D$</strong></td>
<td>$b = r - D$</td>
</tr>
<tr>
<td><strong>Foreign currency with return $r_f$</strong></td>
<td>$b = r - r_f$</td>
</tr>
<tr>
<td><strong>Commodity with storage cost $q$</strong></td>
<td>$b = r + q$</td>
</tr>
<tr>
<td><strong>Futures</strong></td>
<td>$b = 0$</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ol>
<li><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av542948966">金融数学课程</a></p>
</li>
<li><p>孙健 《金融衍生品定价模型—数理金融引论 》中国经济出版社</p>
</li>
</ol>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Finance/" class="category-chain-item">Finance</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Black-Scholes-Model/">#Black Scholes Model</a>
      
        <a href="/tags/Feynman-Kac/">#Feynman-Kac</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>【推导】Feynman-Kac To Black-Scholes-PDE</div>
      <div>http://achlier.github.io/2021/03/14/Feynman-Kac_To_Black-Scholes-PDE/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Hailey</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>March 14, 2021</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>Licensed under</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/03/17/%E7%95%99%E8%A8%80%E6%9D%BF%E7%BD%AE%E9%A1%B6/" title="【留言板置顶】">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">【留言板置顶】</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/03/11/Financial_Toolbox-Portfolio_Optimization/" title="【代码】Financial Toolbox:Portfolio Optimization">
                        <span class="hidden-mobile">【代码】Financial Toolbox:Portfolio Optimization</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>






  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
